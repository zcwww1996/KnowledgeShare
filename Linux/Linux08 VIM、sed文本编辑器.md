[TOC]

# VIM
## VIM工作模式

![vim工作模式.png](https://i0.wp.com/i.loli.net/2019/10/11/HR3npVAxvKCNbF1.png "vim工作模式")

命令模式：又称一般模式

编辑模式：又称底行模式，命令行模式

 

## 插入命令

|命令|作用|
|---|---|
|a|在光标<font color="red">后</font>附加文本|
|A（shift + a）|在本行行末附加文本   行尾|
|i|在光标<font color="red">前</font>插入文本|
|I(shift+i)|在本行开始插入文本 行首|
|o|在光标下插入新行|
|O(shift+o)|在光标上插入新行|

## 定位命令

|命令|作用|
|---|---|
|:set nu|设置行号|
|:set nonu|取消行号|
|gg|到第一行|
|G|到最后一行|
|nG|到第n行|
|:n|到第n行|

## 保存和退出命令

|命令|作用|
|---|---|
|:w|保存修改|
|:w new_filename|另存为指定文件|
|:w >> a.txt|内容追加到a.txt文件中 文件需存在|
|:wq|保存修改并退出|
|shift+zz（ZZ）|快捷键，保存修改并退出|
|:q!|不保存修改退出|
|:wq!|保存修改并退出（文件所有者可忽略文件的只读属性）|
 

不保存并退出：

1， 有修改，但是修改后的内容是不保存的

2， 有突发情况，导致窗口退出。修改文件之后，直接删除同名的.swp文件

## 删除命令

|命令|作用|
|---|---|
|x|删除光标所在处字符   nx 删除光标所在处后n个字符|
|dd|删除光标所在行，ndd删除n行|
|:n1,n2d|删除指定范围的行（eg :1,3d   删除了123这三行）|
|dG|删除光标所在行到末尾的内容|
|D|删除从光标所在处到行尾|

## 复制和剪切命令

|命令|作用|
|---|---|
|yy、Y|复制当前行|
|nyy、nY|复制当前行以下n行|
|dd|剪切当前行|
|ndd|剪切当前行以下n行|
|p、P|粘贴在当前光标所在行下  或行上|
## 替换和取消命令
|命令|作用|
|---|---|
|r|取代光标所在处字符|
|R(shift + r)|从光标所在处开始替换字符，按Esc结束|
|u|undo,取消上一步操作|
|ctrl+r|redo,返回到undo之前|

## 搜索和替换命令
|命令|作用|
|---|---|
|/string|向<font color="red">后</font>搜索指定字符串   搜索时忽略大小写<font color="red">:set ic</font>|
|?string||向前搜索指定字符串|
|n|搜索字符串的下一个出现位置,与搜索顺序相同|
|N（Shift + n）|搜索字符串的上一个出现位置,与搜索顺序相反|
|:<font color="red">%s</font>/old/new/g|全文替换指定字符串|
|:n1,n2s/old/new/g|在一定范围内替换指定字符串|

% 指全文，s 指开始，g 指全局替换

    起始行，终止行s/要替换的字符串/替换的新的字符串/g    c 询问确认
    
-  **:**<font>%s</font>/ftp/yang/g    全局替换，把ftp替换为yang
-  **:**<font>41,44</font>/yang/lee/c   从41行到44行，把yang替换为lee,询问是否替换
-  **:**<font>41,44</font>/yang/lee/g   同上，不询问，直接替换
-  **:**<font color="red">%s</font>/\/root/\/ROOT/g  把/root替换为/ROOT   /需要转义
-  **:**<font color="red">%s/</font>/bin/bash<font color="red">/</font>/bin/ksh/<font color="red">g</font> 把/bin/bash全部替换为/bin/ksh

**使用替换命令来添加删除注释**

:% s/^/#/g 来在全部内容的行首添加 # 号注释

:1,10 s/^/#/g 在1~10 行首添加 # 号注释

vi里面怎么查命令？？

<font color="red">:! which cp</font>

vi里面怎么导入命令的结果？

<font color="red">:r! which cp</font>
 
## 可视化模式
v  可视字符模式

**V(shift+v)** 可视行模式，选择多行操作

**ctrl+v** 可视块模式（列模式），操作列

I或者A进入插入模式。

# 2. sed

参考：https://blog.csdn.net/qq_33468857/article/details/84324609

## 2.1 sed简介

sed 全名为 stream editor，流编辑器，用程序的方式来编辑文本。与vim等编辑器不同，sed 是一种非交互式编辑器(即用户不必参与编辑过程)，它使用预先设定好的编辑指令对输入的文本进行编辑，完成之后再输出编辑结构。sed 基本上就是在玩正则模式匹配。

## 2.2 sed工作原理

sed会一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，成为"模式空间"，接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有改变，除非你使用重定向存储输出。


## 2.3 常用正则
|字符|描述|
|:---|:---|
| $ |匹配输入字符串的结尾位置。如果设置了RegExp 对象的 Multiline 属性，则`$`也匹配 `'\n'` 或 `'\r'` 。要匹配`$`字符本身，请使用`\$`。|
| ( |标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 `\(` 和 `\)`。|
| \* |匹配前面的子表达式零次或多次。要匹配`*` 字符，请使用`\*`。|
| + |匹配前面的子表达式一次或多次。要匹配`+` 字符，请使用`\+`。|
| . |匹配除换行符 `\n` 之外的任何单字符。要匹配 . ，请使用 `\.` 。|
| [ |标记一个中括号表达式的开始。要匹配 `[`，请使用 `\[`。|
| ? |匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。要匹配 `?` 字符，请使用 `\?`。
| \ |将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如， `'n'` 匹配字符 `'n'`。`'\n'` 匹配换行符。序列 `'\\'` 匹配 `"\"`，而 `'\('` 则匹配 `"("`。|
| ^ |匹配输入字符串的开始位置，(在中括号表达式中使用，表示取集合反向匹配)。要匹配`^` 字符本身，请使用 `\^`。|
| { |标记限定符表达式的开始。要匹配 `{`，请使用 `\{`。|
| | |指明两项之间的一个选择。要匹配 `|`，请使用 `\|`。|


## 2.4 sed常见使用

```bash
[root@www ~] sed [-nefr] [动作]
选项与参数：
-n ：使用安静(silent)模式。在一般 sed 的用法中，所有来自 STDIN 的数据一般都会被列出到终端上。但如果加上 -n 参数后，则只有经过sed 特殊处理的那一行(或者动作)才会被列出来。
-e ：直接在命令列模式上进行 sed 的动作编辑；
-f ：直接将 sed 的动作写在一个文件内， -f filename 则可以运行 filename 内的 sed 动作；
-r ：sed 的动作支持的是延伸型正规表示法的语法。(默认是基础正规表示法语法)
-i ：直接修改读取的文件内容，而不是输出到终端。
 
动作说明： [n1[,n2]]function
n1, n2 ：不见得会存在，一般代表『选择进行动作的行数』，举例来说，如果我的动作是需要在 10 到 20 行之间进行的，则『 10,20[动作行为] 』
 
function：
a ：新增， a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)～
c ：取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行！
d ：删除，因为是删除啊，所以 d 后面通常不接任何咚咚；
i ：插入， i 的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)；
p ：列印，亦即将某个选择的数据印出。通常 p 会与参数 sed -n 一起运行～
s ：取代，可以直接进行取代的工作哩！通常这个 s 的动作可以搭配正规表示法！例如 1,20s/old/new/g 就是啦！
```

### 2.4.1 sed -i


sed默认会把输入行读取到模式空间，简单理解就是一个内存缓冲区，sed子命令处理的内容是模式空间中的内容，而非直接处理文件内容。因此在sed修改模式空间内容之后，并非直接写入修改输入文件，而是打印输出到标准输出。如果需要修改输入文件，那么就可以指定-i选项。

 例子1：

```bash
cat file.txt
hello world
[root@localhost]# sed 's/hello/A/' file.txt
A world
[root@localhost]# cat file.txt
hello world
```

例子2：

```bash
[root@localhost]# sed -i 's/hello/A/' file.txt
[root@localhost]# cat file.txt
A world
```

例子3：

```bash
[root@localhost]# sed –i.bak 's/hello/A/' file.txt
```

说明：最后一个例子会把**修改内容保存到file.txt，同时会以file.txt.bak文件备份原来未修改文件内容**，以确保原始文件内容安全性，防止错误操作而无法恢复原来内容。

**替换文件内容**
```bash
单次替换
sed -i 's/原字符串/新字符串/' /home/1.txt
全局替换
sed -i 's/原字符串/新字符串/g' /home/1.txt

去掉 “行首” 带“@”的首字母@
sed -i 's/^@//' file

特定字符串的行前插入新行
sed -i '/特定字符串/i 新行字符串' file

特定字符串的行后插入新行
sed -i '/特定字符串/a 新行字符串' file

特定字符串的删除
sed -i '/字符串/d' file
```

### 2.4.2 sed -n

sed默认会把模式空间处理完毕后的内容输出到标准输出，也就是输出到屏幕上，加上-n选项后被设定为安静模式，也就是不会输出默认打印信息，除非子命令中特别指定打印选项，则只会把匹配修改的行进行打印。

例子1：

```bash
echo -e 'hello world\nnihao' | sed 's/hello/A/'
结果：
A world
nihao
```


例子2：

```bash
echo -e 'hello world\nnihao' | sed -n 's/hello/A/'
结果：加-n选项后什么也没有显示。
```


例子3：

```bash
echo -e 'hello world\nnihao' | sed -n 's/hello/A/p'
结果：A world/
说明：-n选项后，再加p标记，只会把匹配并修改的内容打印了出来。
```

### 2.4.3 sed -e

如果需要用sed对文本内容进行多种操作，则需要执行多条子命令来进行操作。

例子1：

```bash
echo -e 'hello world' | sed -e 's/hello/A/' -e 's/world/B/'
结果：A B
```

例子2：

```bash
echo -e 'hello world' | sed 's/hello/A/;s/world/B/'
结果：A B
```

说明：例子1和例子2的写法的作用完全等同，可以根据喜好来选择，如果需要的子命令操作比较多的时候，无论是选择-e选项方式，还是选择分号的方式，都会使命令显得臃肿不堪，此时使用-f选项来指定脚本文件来执行各种操作会比较清晰明了。


### 2.4.4 sed -f

还记得 -e 选项可以来执行多个子命令操作，用分号分隔多个命令操作也是可以的，如果命令操作比较多的时候就会比较麻烦，这时候把多个子命令操作写入脚本文件，然后使用 -f 选项来指定该脚本。
例子1：

```bash
echo "hello world" | sed -f sed.script
结果：A B
```

sed.script脚本内容：

```bash
s/hello/A/
s/world/B/
```

说明：在脚本文件中的子命令串就**不需要输入单引号**了。

### 2.4.5 sed -r

sed命令的匹配模式支持正则表达式的，默认只能支持基本正则表达式，如果需要支持扩展正则表达式，那么需要添加-r选项。
例子1：

```bash
echo "hello world" | sed -r 's/(hello)|(world)/A/g'
A A
```

## 2.5 数字定址和正则定址

### 2.5.1 关于定址的概念

默认情况下sed会对每一行内容进行匹配 处理 输出，某些情况不需要对处理的文本全部编辑，只需要其中的一部分，比如1-10行，偶数行，或者是包含"hello"字符串的行，这种情况下就需要我们去定位特定的行来处理，而不是全部内容，这里把这个定位指定的行叫做"定址"。

### 2.5.2 数字定址

数字定址其实就是通过数字去指定具体要操作编辑的行，数字定址有几种方式，每种方式都有不同的应用场景，下边以举例的方式来描述每种数字定址的用法。

例子1：

```bash
sed –n ‘4s/hello/A/’ message
```

说明：将第4行中hello字符串替换为A，其它行如果有hello也不会被替换。

例子2：

```bash
sed –n ‘2,4s/hello/A/’ message
```

说明：将第2-4行中hello字符串替换为A，其它行如果有hello也不会被替换。

例子3：

```bash
sed –n ‘2,+4s/hello/A/’ message
```

说明：从第2行开始，再接着往下数4行，也就是2-6行，这些行会把hello字符替换为A。

例子4：

```bash
sed –n ‘4,~3s/hello/A/’ message
```

说明：第4行开始，到第6行。解释6的由来，"4,~3"表示从4行开始到下一个3的倍数，这里从4开始算，那就是6了，当然9就不是了，因为是要求3的第一个超过前边数字4的倍数，感觉这种适用场景不会太多。

例子5：

```bash
sed –n ‘4~3s/hello/A/’ message
```

说明：从第4行开始，每隔3行就把hello替换为A。比如从4行开始，7行，10行等依次+3行。这个比较常用，比如3替换为2的时候，也就是每隔2行的步调，可以实现 ==**奇数和偶数行的操作**==。

例子6：

```bash
sed –n ‘$s/hello/A/’ message
```

说明：$符号表示最后一行，和正则中的$符号类似，但是第1行不用^表示，直接1就行了。

例子7：

```bash
sed -n ‘1!s/hello/A/’ message
```

说明：!符号表示取反，该命令是将除了第1行，其它行hello替换为A，上述定址方式也可以使用！符号。

### 2.5.3 正则定址

正则定址使用目的和数字定址完全一样，使用方式上有所不同，是通过正则表达式的匹配来确定需要处理编辑哪些行，其它行就不需要额外处理。

例子1：

```bash
sed -n ‘/nihao/d’ message
```
说明：将匹配到nihao的行执行删除操作。

例子2：

```bash
sed -n ‘/^$/d’ message
```
说明：删除空行


例子3：

```bash
sed -n ‘/^TS/,/^TE/d’ message
```

说明：匹配以TS开头的行到TE开头的行之间的行，把匹配到的这些行删除。

### 2.5.4 数字定址和正则定址混用

其实数字定址和正则定址可以配合使用，参考下边的例子。

例子1：

```bash
sed -n ‘1,/^TS/d’ message
```

说明：匹配从第1行到TS开头的行，把匹配的行删除。

### 2.5.5 关于定址的分组命令

例子1：

```bash
/^TS/,/^TE/{
s/CN/China/
s/Beijing/BJ/
}
```

说明：该命令表示将从TS开头的行到TE开头的行之间范围的行内容中CN替换为China，并且把Beijing替换为BJ，类似于多命令之间用分号的那种方式，不过这样定址代码只写了一遍，相当于执行了一条子命令。
