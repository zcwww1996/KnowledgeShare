[TOC]

参考链接：<br>
https://blog.csdn.net/yjclsx/article/details/81508455<br>
https://www.cnblogs.com/sunshuhai/p/6250514.html

# top命令用法
top命令经常用来监控linux的系统状况，是常用的性能分析工具，能够实时显示系统中各个进程的资源占用情况。

top的使用方式 `top [-d number] | top [-bnp]`

参数解释：
- -d：number代表秒数，表示top命令显示的页面更新一次的间隔。默认是5秒。
- -b：以批次的方式执行top。
- -n：与-b配合使用，表示需要进行几次top命令的输出结果。
- -p：指定特定的pid进程号进行观察。

在top命令显示的页面还可以输入以下按键执行相应的功能（注意大小写区分的）：

- -?：显示在top当中可以输入的命令
- -P：以CPU的使用资源排序显示 M：以内存的使用资源排序显示
- -N：以pid排序显示
- -T：由进程使用的时间累计排序显示
- -k：给某一个pid一个信号。可以用来杀死进程
- -r：给某个pid重新定制一个nice值（即优先级）
- -q：退出top（用ctrl+c也可以退出top）。

# top各输出参数含义
下面是使用top命令来进行性能检测的截图

[![top进程列表](https://hbimg.huabanimg.com/b404a234064ec0c2449224e057e0eb6815aaf139272e8-h9AZd3_fw658 "top进程列表")](https://hbimg.huabanimg.com/b404a234064ec0c2449224e057e0eb6815aaf139272e8-h9AZd3_fw658 "top进程列表")

## 一、top前5行统计信息
**第1行：top - 05:43:27 up 4:52, 2 users, load average: 0.58, 0.41, 0.30**<br>

第1行是任务队列信息，其参数如下：

|内容|含义|
| ------------ | ------------ |
| 05:43:27|表示当前时间|
|up 4:52|系统运行时间 格式为时：分|
|2 users|当前登录用户数|
|load average: 0.58, 0.41, 0.30|系统负载，即任务队列的平均长度。 三个数值分别为 1分钟、5分钟、15分钟前到现在的平均值。|
load average: 如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。

**第2行：Tasks: 159 total, 1 running, 158 sleeping, 0 stopped, 0 zombie**<br>
**第3行：%Cpu(s): 37.0 us, 3.7 sy, 0.0 ni, 59.3 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st**<br>
第2、3行为进程和CPU的信息

当有多个CPU时，这些内容可能会超过两行，其参数如下：

|内容|含义|
| :------------: |------------|
|159 total|进程总数|
|1 running|正在运行的进程数|
|158 sleeping|睡眠的进程数|
|0 stopped|停止的进程数|
|0 zombie|僵尸进程数|
|37.0 us|用户空间占用CPU百分比|
|3.7 sy|内核空间占用CPU百分比|
|0.0 ni|用户进程空间内改变过优先级的进程占用CPU百分比|
|59.3 id|空闲CPU百分比|
|0.0 wa|等待输入输出的CPU时间百分比|
|0.0 hi|硬中断（HardwareIRQ）占用CPU的百分比|
|0.0 si|软中断（SoftwareInterrupts）占用CPU的百分比|
|0.0 st|虚拟机占用百分比|

第4行：KiB Mem: 1530752 total, 1481968 used, 48784 free, 70988 buffers<br>
第5行：KiB Swap: 3905532 total, 267544 used, 3637988 free. 617312 cached Mem <br>
第4、5行为内存信息

其参数如下：

|内容|含义|
|------------|------------|
|KiB Mem: 1530752 total|物理内存总量|
|1481968 used|使用的物理内存总量|
|48784 free|空闲内存总量|
|70988 buffers（buff/cache）|用作内核缓存的内存量|
|KiB Swap: 3905532 total|交换区总量|
|267544 used|使用的交换区总量|
|3637988 free|空闲交换区总量|
|617312 cached Mem|缓冲的交换区总量。|
|3156100 avail Mem|代表可用于进程下一次分配的物理内存数量|

上述最后提到的缓冲的交换区总量，这里解释一下，所谓缓冲的交换区总量，即内存中的内容被换出到交换区，而后又被换入到内存，但使用过的交换区尚未被覆盖，该数值即为这些内容已存在于内存中的交换区的大小。相应的内存再次被换出时可不必再对交换区写入。 

计算可用内存数有一个近似的公式： 
第四行的free + 第四行的buffers + 第五行的cached
## 二、进程信息

|列名|含义|
|------------|------------|
|PID|进程id|
|PPID|父进程id|
|RUSER|Real user name|
|UID|进程所有者的用户id|
|USER|进程所有者的用户名|
|GROUP|进程所有者的组名|
|TTY|启动进程的终端名。不是从终端启动的进程则显示为 ?|
|PR|优先级|
|NI|nice值。负值表示高优先级，正值表示低优先级|
|P|最后使用的CPU，仅在多CPU环境下有意义|
|%CPU|上次更新到现在的CPU时间占用百分比|
|TIME|进程使用的CPU时间总计，单位秒|
|TIME+|进程使用的CPU时间总计，单位1/100秒|
|%MEM|进程使用的物理内存百分比|
|VIRT|进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES|
|SWAP|进程使用的虚拟内存中，被换出的大小，单位kb|
|RES|进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA|
|CODE|可执行代码占用的物理内存大小，单位kb|
|DATA|可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb|
|SHR|共享内存大小，单位kb|
|nFLT|页面错误次数|
|nDRT|最后一次写入到现在，被修改过的页面数。|
|S|进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程|
|COMMAND|命令名/命令行|
|WCHAN|若该进程在睡眠，则显示睡眠中的系统函数名|
|Flags|任务标志|

# 其他

默认进入top时，各进程是按照CPU的占用量来排序的。

1. 在top基本视图中，按键盘数字“1”可以监控每个逻辑CPU的状况：<br>
![top_监控每个逻辑CPU](https://hbimg.huabanimg.com/3e9afd8d59c5a109c90a76797cc7f650e6d11d3495da-cUfY1R_fw658 "top_监控每个逻辑CPU")

2. 敲击键盘‘b’（打开关闭加亮效果）top视图变换如下：<br>
![top_打开关闭加亮效果](https://hbimg.huabanimg.com/f986a038fb03035a5d6e9cc0b02ce3cfbaf364df78c7-XtBeK1_fw658 "top_打开关闭加亮效果")<br>
PID为16283为当前top视图中唯一的运行态进程。也可以敲击键盘‘y’来打开或者关闭运行态进程的加亮效果。

3. 敲击键盘‘x’（打开/关闭排序列的加亮效果），top视图变换如下：<br>
![top_打开或关闭排序列的加亮效果](https://hbimg.huabanimg.com/bbebf5dd2c13638f0f16d9085fe712c5e6942bd27804-1fVHNZ_fw658 "top_打开或关闭排序列的加亮效果")<br>
可以看到现在是按"%CPU"进行排序的，可以按”shift+>”或者”shift+<”左右改变排序序列。

4. 改变进程显示字段<br>
在top基本视图中，敲击”f”进入另一个视图，在这里可以编辑基本视图中的显示字段：<br>
![top_改变进程显示字段](https://hbimg.huabanimg.com/80044b890b7e48d7ad85486dfe9f29cda4e6f43b3fd9-7BM7S2_fw658 "top_改变进程显示字段")

用上下键选择选项，按下空格键可以决定是否在基本视图中显示这个选项。

总结：<br>
top命令是一个非常强大的功能，但是它监控的最小单位是进程，如果想监控更小单位时，就需要用到ps或者netstate命令来满足我们的要求。